<div class="flex flex-col flex-auto min-w-0">
    <!-- Main -->
    <div class="flex-auto px-6 py-4 sm:px-10 sm:py-7">
        <!-- CONTENT GOES HERE -->
        <div class="flex flex-col">
            <div class="grid grid-cols-4 gap-2">
                <mat-form-field>
                    <mat-label>Unidades</mat-label>
                    <mat-select [(value)]="selectedUnit">
                        <mat-option
                            *ngFor="let unit of classrooms"
                            [value]="unit.id"
                            >{{ unit.nombre }}</mat-option
                        >
                        <mat-option (click)="openCreateUnitModal()"
                            >Crear Unidad</mat-option
                        >
                    </mat-select>
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Grado</mat-label>
                    <mat-select
                        (selectionChange)="onGradoSelected($event.value)"
                    >
                        <mat-option
                            *ngFor="let grado of grados"
                            [value]="grado.id"
                            >{{ grado.nombre }}</mat-option
                        >
                    </mat-select>
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Sección</mat-label>
                    <mat-select [(value)]="selectedSeccionId">
                        <mat-option
                            *ngFor="let seccion of secciones"
                            [value]="seccion.id"
                            >{{ seccion.secccion }}</mat-option
                        >
                    </mat-select>
                </mat-form-field>
                <div class="flex items-center">
                    <button mat-icon-button (click)="filterStudentsByClassroom()">
                        <mat-icon [svgIcon]="'filter_alt'" />
                    </button>
                </div>
            </div>

            <!-- Inicio del modal para crear unidad -->
            <div
                *ngIf="showCreateUnitModal"
                class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-20"
            >
                <div
                    class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
                >
                    <h2 class="text-center text-lg font-bold">
                        Desea crear una nueva unidad?
                    </h2>
                    <div class="mt-5 text-center">
                        <button
                            mat-button
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                            (click)="onCreateUnit()"
                        >
                            Aceptar
                        </button>
                        <button
                            mat-button
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded ml-4"
                            (click)="onCancelCreateUnit()"
                        >
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
            <!-- Fin del modal -->

            <div class="flex flex-col gap-4">
                <div>
                    <mat-button-toggle-group
                        [(ngModel)]="items"
                        aria-label="Font Style"
                    >
                        <mat-button-toggle value="list"
                            >Listar</mat-button-toggle
                        >
                        <mat-button-toggle value="assign"
                            >Asignar Estudiantes</mat-button-toggle
                        >
                        <mat-button-toggle value="register"
                            >Registrar Estudiantes</mat-button-toggle
                        >
                    </mat-button-toggle-group>
                </div>
                <div>
                    @switch(items){ @case("list"){
                    <div class="flex flex-col gap-4">
                        <div class="flex gap-4">
                            @if(isTestEnabled){
                            <button mat-button>
                                Detener Prueba Psicológica
                            </button>

                            } @else {
                            <button mat-button>
                                Iniciar Prueba Psicológica
                            </button>

                            }
                        </div>
                        <table
                            mat-table
                            [dataSource]="dataSource"
                            class="mat-elevation-z8"
                        >
                            <!-- Checkbox Column -->
                            <ng-container matColumnDef="select">
                                <th mat-header-cell *matHeaderCellDef>
                                    <mat-checkbox
                                        (change)="
                                            $event ? toggleAllRows() : null
                                        "
                                        [checked]="
                                            selection.hasValue() &&
                                            isAllSelected()
                                        "
                                        [indeterminate]="
                                            selection.hasValue() &&
                                            !isAllSelected()
                                        "
                                        [aria-label]="checkboxLabel()"
                                    >
                                    </mat-checkbox>
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <mat-checkbox
                                        (click)="$event.stopPropagation()"
                                        (change)="
                                            $event
                                                ? selection.toggle(row)
                                                : null
                                        "
                                        [checked]="selection.isSelected(row)"
                                        [aria-label]="checkboxLabel(row)"
                                    >
                                    </mat-checkbox>
                                </td>
                            </ng-container>

                            <!-- Position Column -->
                            <ng-container matColumnDef="Nombres">
                                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.Nombres }}
                                </td>
                            </ng-container>

                            <!-- Name Column -->
                            <ng-container matColumnDef="ApellidoPaterno">
                                <th mat-header-cell *matHeaderCellDef>Apellido Paterno</th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.ApellidoPaterno }}
                                </td>
                            </ng-container>

                            <!-- Weight Column -->
                            <ng-container matColumnDef="ApellidoMaterno">
                                <th mat-header-cell *matHeaderCellDef>
                                    Apellido Materno
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.ApellidoMaterno }}
                                </td>
                            </ng-container>

                            <!-- Symbol Column -->
                            <ng-container matColumnDef="DNI">
                                <th mat-header-cell *matHeaderCellDef>
                                    DNI
                                </th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.DNI }}
                                </td>
                            </ng-container>

                            <tr
                                mat-header-row
                                *matHeaderRowDef="displayedColumns"
                            ></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedColumns"
                                (click)="selection.toggle(row)"
                            ></tr>
                        </table>
                    </div>
                    } @case("assign"){
                    <div class="flex flex-col">
                        <mat-form-field class="flex flex-col">
                            <mat-chip-grid
                                #chipGrid
                                aria-label="Fruit selection"
                            >
                                @for (fruit of fruits; track fruit) {
                                <mat-chip-row (removed)="remove(fruit)">
                                    {{ fruit }}
                                    <button
                                        matChipRemove
                                        [attr.aria-label]="'remove ' + fruit"
                                    >
                                        <mat-icon>cancel</mat-icon>
                                    </button>
                                </mat-chip-row>
                                }
                            </mat-chip-grid>
                            <input
                                class="w-full"
                                placeholder="New Fruit..."
                                #fruitInput
                                [formControl]="fruitCtrl"
                                [matChipInputFor]="chipGrid"
                                [matAutocomplete]="auto"
                                [matChipInputSeparatorKeyCodes]="
                                    separatorKeysCodes
                                "
                                (matChipInputTokenEnd)="add($event)"
                            />
                            <mat-autocomplete
                                #auto="matAutocomplete"
                                (optionSelected)="selected($event)"
                            >
                                @for (fruit of filteredFruits | async; track
                                fruit) {
                                <mat-option [value]="fruit">{{
                                    fruit
                                }}</mat-option>
                                }
                            </mat-autocomplete>
                        </mat-form-field>
                        <div>
                            <button mat-button>Asignar</button>
                        </div>
                    </div>
                    } @case("register"){
                    <!-- Agregar componente de registro aqui -->
                    <div class="flex-auto py-1 sm:py-3">
                        <div class="flex flex-col gap-4">
                            <div class="flex flex-col items-start">
                                <div class="w-full">
                                    <form
                                        [formGroup]="formRegistrarEstudiante"
                                        class="flex flex-col p-8 bg-card rounded-2xl shadow overflow-hidden"
                                    >
                                        <mat-form-field class="flex-auto">
                                            <mat-label>Nombre</mat-label>
                                            <input
                                                type="text"
                                                matInput
                                                formControlName="nombre"
                                                placeholder="Ingrese su nombre"
                                            />
                                            <mat-error
                                                *ngIf="
                                                    formRegistrarEstudiante.get(
                                                        'nombre'
                                                    ).invalid &&
                                                    formRegistrarEstudiante.get(
                                                        'nombre'
                                                    ).touched
                                                "
                                            >
                                                Falta ingresar nombre
                                            </mat-error>
                                        </mat-form-field>
                                        <mat-form-field class="flex-auto">
                                            <mat-label
                                                >Apellido Paterno</mat-label
                                            >
                                            <input
                                                type="text"
                                                matInput
                                                formControlName="apellidoPaterno"
                                                required
                                                placeholder="Ingrese su apellido paterno"
                                            />
                                            <mat-error
                                                *ngIf="
                                                    formRegistrarEstudiante.get(
                                                        'apellidoPaterno'
                                                    ).invalid &&
                                                    formRegistrarEstudiante.get(
                                                        'apellidoPaterno'
                                                    ).touched
                                                "
                                            >
                                                Falta ingresar apellido paterno
                                            </mat-error>
                                        </mat-form-field>
                                        <mat-form-field class="flex-auto">
                                            <mat-label
                                                >Apellido Materno</mat-label
                                            >
                                            <input
                                                type="text"
                                                matInput
                                                formControlName="apellidoMaterno"
                                                placeholder="Ingrese su apellido materno"
                                            />
                                            <mat-error
                                                *ngIf="
                                                    formRegistrarEstudiante.get(
                                                        'apellidoMaterno'
                                                    ).invalid &&
                                                    formRegistrarEstudiante.get(
                                                        'apellidoMaterno'
                                                    ).touched
                                                "
                                            >
                                                Falta ingresar apellido materno
                                            </mat-error>
                                        </mat-form-field>
                                        <mat-form-field class="flex-auto">
                                            <mat-label>DNI</mat-label>
                                            <input
                                                type="number"
                                                matInput
                                                formControlName="dni"
                                                placeholder="Ingrese su DNI"
                                            />
                                            <mat-error
                                                *ngIf="
                                                    formRegistrarEstudiante.get(
                                                        'dni'
                                                    ).invalid &&
                                                    formRegistrarEstudiante.get(
                                                        'dni'
                                                    ).touched
                                                "
                                            >
                                                El DNI tiene que tener 8 dígitos
                                            </mat-error>
                                        </mat-form-field>
                                        <div class="flex justify-end mt-4">
                                            <button
                                                mat-raised-button
                                                color="warn"
                                                class="mr-2"
                                            >
                                                Cancelar
                                            </button>
                                            <button
                                                mat-raised-button
                                                color="primary"
                                                [disabled]="
                                                    formRegistrarEstudiante.invalid
                                                "
                                            >
                                                Guardar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    }}
                </div>
            </div>
        </div>
    </div>
</div>
